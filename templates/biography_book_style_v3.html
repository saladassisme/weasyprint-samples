<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="author" content="{{ book_info.author }}">
    <title>{{ book_info.title }}</title>
    <style>
        /* 自定义页面尺寸和样式 */
        @page {
            margin: 1.5cm 2cm 2cm 2cm;
            size: 140mm 210mm;
        }

        @page :left {
            @bottom-left {
                content: counter(page);
                position: absolute;
                z-index: -1;
                font-size: 10pt;
            }
            @bottom-right {
                content: string(heading);
                position: absolute;
                z-index: -1;
                font-size: 10pt;
            }
        }

        @page :right {
            @bottom-left {
                content: string(heading);
                position: absolute;
                z-index: -1;
                font-size: 10pt;
            }
            @bottom-right {
                content: counter(page);
                position: absolute;
                z-index: -1;
                font-size: 10pt;
            }
        }

        @page full {
            @bottom-right { content: none; }
            @bottom-left { content: none; }
            background: url('file:///C:/Users/xutin/Desktop/小工具/weasyprint-samples/cover_bg.jpg') no-repeat center center;
            background-size: cover;
            margin: 0;
            size: 140mm 210mm;
        }

        @page clean {
            @bottom-right { content: none; }
            @bottom-left { content: none; }
            size: 140mm 210mm;
        }

        @page back-cover {
            @bottom-right { content: none; }
            @bottom-left { content: none; }
            background: url('file:///C:/Users/xutin/Desktop/小工具/weasyprint-samples/back_cover.jpg') no-repeat center center;
            background-size: cover;
            margin: 0;
            size: 140mm 210mm;
        }

        /* 基础样式 */
        html {
            counter-reset: h2-counter;
            font-family: "Microsoft YaHei", "SimSun", serif;
            font-size: 12pt; /* 增大基础字号 */
        }
        
        body {
            margin: 0;
            color: #333;
        }
        
        /* 段落样式 */
        p {
            line-height: 1.8;
            text-align: justify;
            text-indent: 2em;
            margin: 1em 0;
            font-size: 14pt; /* 增大正文字号从12pt到14pt */
        }
        
        /* 标题样式 */
        h1 {
            position: absolute;
            visibility: hidden;
        }
        
        h2 {
            color: white;
            counter-increment: h2-counter;
            display: flex;
            flex-direction: column;
            font-family: "Microsoft YaHei", "SimSun", serif;
            font-size: 2.2em; /* 增大章节标题字号 */
            height: 4cm; /* 减小高度 */
            justify-content: flex-start; /* 改为顶部对齐，让标题更靠近顶部 */
            margin: 0;
            padding-top: 0.3cm; /* 减少顶部间距 */
            padding-bottom: 0.5cm; /* 增加底部间距 */
            string-set: heading content();
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        h2::before {
            content: "第" counter(h2-counter, cjk-ideographic) "篇 ";
            display: block;
            font-size: 0.8em;
            font-weight: normal;
            line-height: 1;
        }
        
        h3 {
            font-size: 1.8em;
            text-align: center;
            margin: 1.5em 0;
            color: #333;
        }
        
        /* 章节样式 */
        section {
            break-after: right;
        }
        
        .chapter {
            break-after: right;
            position: relative;
            padding-top: 0cm; /* 减少顶部间距，让背景装饰吸顶 */
        }
        
        .chapter::before {
            background: center / cover;
            border-radius: 0 0 50% 50% / 0 0 15mm 15mm;
            content: "";
            display: block;
            height: 60mm; /* 减小高度 */
            left: -20mm;
            position: absolute;
            top: -1.5cm; /* 向上偏移页面边距，使背景装饰真正吸顶 */
            width: 180mm;
            z-index: -1;
            opacity: 0.9;
        }
        
        /* 为不同章节设置不同的背景色 */
        .chapter-1::before { background-color: #e74c3c; }
        .chapter-2::before { background-color: #3498db; }
        .chapter-3::before { background-color: #2ecc71; }
        .chapter-4::before { background-color: #f39c12; }
        .chapter-5::before { background-color: #9b59b6; }
        .chapter-6::before { background-color: #1abc9c; }
        
        /* 封面样式 - 优化布局 */
        .cover-page {
            page: full;
            color: #2c2c2c; /* 深灰色文字 */
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* 改为两端对齐 */
            align-items: center;
            text-align: center;
            padding: 2cm 2cm 3cm 2cm; /* 调整内边距 */
            margin: 0;
            height: 100%;
        }
        
        .cover-title {
            font-size: 2.8em;
            font-weight: bold;
            margin-bottom: 8cm;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3); /* 增强阴影 */
            position: relative;
            z-index: 2;
            font-family: "STKaiti", "KaiTi", "楷体", serif;
            letter-spacing: 0.15em;
            color: #1a1a1a; /* 更深的颜色 */
            margin-top: 2.5cm; /* 顶部留白 */
        }
        
        .cover-author {
            font-size: 1.4em;
            position: relative;
            z-index: 2;
            font-family: "STKaiti", "KaiTi", "楷体", serif;
            letter-spacing: 0.1em;
            color: #2c2c2c;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
            margin-bottom: 2cm; /* 底部留白 */
        }
        
        /* 封底样式 */
        .back-cover {
            page: back-cover;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: #666;
        }
        
        .back-cover-content {
            font-family: "STKaiti", "KaiTi", "楷体", serif;
            font-size: 1.2em;
            opacity: 0.7;
        }
        
        /* 作者信息页 */
        .author-info {
            page: clean;
            text-align: center;
        }
        
        .author-info h3 {
            font-size: 1.8em;
            margin-bottom: 1.5em;
            color: #333;
        }
        
        .author-info p {
            font-size: 13pt; /* 增大作者信息字号 */
            line-height: 1.6;
            text-indent: 0;
            margin: 1em 0;
            color: #555;
        }
        
        /* 目录样式 */
        .contents {
            page: clean;
        }
        
        .contents h3 {
            font-size: 2em;
            text-align: center;
            margin-bottom: 1.5em;
            color: #333;
        }
        
        .contents ul {
            list-style: none;
            padding: 0;
        }
        
        .contents li {
            margin: 1.2em 0;
            font-size: 13pt; /* 增大目录字号 */
        }
        
        .contents a {
            color: #333;
            text-decoration: none;
            display: block;
            padding: 0.3em 0;
        }
        
        .contents a::after {
            content: target-counter(attr(href), page);
            float: right;
            color: #666;
        }
        
        /* 荣誉证书部分 - 已移除 */
        
        /* 版权信息 */
        .copyright {
            page: clean;
            text-align: center;
            padding: 2cm 1.5cm;
            color: #666;
        }
        
        .copyright p {
            font-size: 11pt;
            text-indent: 0;
            margin: 1em 0;
        }
        
        /* 图片样式 */
        img {
            display: block;
            margin: 1.5em auto;
            max-width: 80%;
        }
        
        aside {
            display: flex;
            justify-content: center;
        }
        
        aside figure {
            flex: none;
            margin: 0;
            padding: 1em;
            text-align: center;
        }
        
        aside img {
            border: 0.4mm solid white;
            border-radius: 50%;
            margin: 0 auto;
            max-width: 14mm;
        }
    </style>
</head>
<body>
    <h1>{{ book_info.title }}</h1>
    
    <!-- 封面页 -->
    <section class="cover-page">
        <div class="cover-title">{{ book_info.title }}</div>
        <div class="cover-author">作者 {{ book_info.author }}</div>
    </section>
    
    <!-- 作者信息页 -->
    <section class="author-info">
        <h3>关于作者</h3>
        <p>{{ book_info.author }}，生于1948年5月，松江华阳桥长楼村人。</p>
        <p>一生从事教育工作，从民办教师到食堂管理，见证了时代变迁。</p>
        <p>虽历经坎坷，但始终保持乐观坚韧的人生态度。</p>
        <p>本书记录了他从童年到暮年的人生历程，展现了一个普通人的不凡人生。</p>
    </section>
    
    <!-- 目录页 -->
    <section class="contents">
        <h3>目录</h3>
        <ul>
            {% for item in table_of_contents %}
            <li><a href="#chapter-{{ loop.index }}-title">{{ item.chapter }} {{ item.title }}</a></li>
            {% endfor %}
        </ul>
    </section>
    
    <!-- 各章节内容 -->
    {% for chapter in chapters %}
    <section id="chapter-{{ chapter.id }}" class="chapter chapter-{{ chapter.id }}">
        <h2 id="chapter-{{ chapter.id }}-title">{{ chapter.title }}</h2>
        
        {% for paragraph in chapter.content %}
        <p>{{ paragraph }}</p>
        {% endfor %}
        
        {% if chapter.images %}
        {% for image in chapter.images %}
        <aside>
            <figure>
                <img src="{{ image.url }}" alt="{{ image.alt }}">
                <figcaption>{{ image.caption }}</figcaption>
            </figure>
        </aside>
        {% endfor %}
        {% endif %}
    </section>
    {% endfor %}
    
    <!-- 荣誉证书部分 -->
    <!-- 已移除荣誉证书部分 -->
    
    <!-- 版权页 -->
    <section class="copyright">
        <p>{{ book_info.copyright }}</p>
        <p>整理：{{ book_info.compiler }}</p>
        <p>联系方式：{{ book_info.contact.email }}</p>
        <p>电话：{{ book_info.contact.phone }}</p>
    </section>
    
    <!-- 封底页 -->
    <section class="back-cover">
        <div class="back-cover-content">
            <p></p>
        </div>
    </section>
</body>
</html>
